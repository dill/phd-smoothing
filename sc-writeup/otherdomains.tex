% Report of results from Ramsay simulation experiment
% David Lawrence Miller
% d.l.miller@bath.ac.uk

% Started : 8th April 2009

\documentclass[a4paper,10pt]{amsart}

% Load some packages
\usepackage{times, amsmath, amssymb, amsfonts, url, natbib, bm, rotating,multirow,graphicx}
\usepackage[margin=1in]{geometry}

% top matter
\title{Smoothing over irregular shapes using the Schwarz-Christoffel transform}
\author{David Lawrence Miller}
\email{d.l.miller@bath.ac.uk}
\address{Mathematical Sciences, University of Bath, Bath, United Kingdom}

% Shortcuts
% Probability
\newcommand{\prob}[1]{\mathbb{P}\left[ #1 \right]}
% Hovitz-Thompson
\newcommand{\HT}{\hat{\tau}_{HT}}
% Schwarz-Christoffel
\newcommand{\sch}{Schwarz-Christoffel }
% fprime
\newcommand{\fprime}{f^\prime(z)}
% figure reference command
\newcommand{\fig}[1]{\emph{fig.} (\ref{#1})}
% figure reference command (start of sentance
\newcommand{\Fig}[1]{\emph{Fig.} (\ref{#1})}
% equation reference command
\newcommand{\eqn}[1]{\emph{eqn.} (\ref{#1})}
% phi inverse
\newcommand{\phiinv}{\phi^{-1}}
% use other phi
\newcommand{\ophi}{\phi}
\renewcommand{\phi}{\varphi}




\begin{document}

% The abstract
\begin{abstract}
Following on from looking at the Ramsay horseshoe, other polygon mappings are simulated from and transformed with the \sch transform. [ADD CONCLUSION HERE]
\end{abstract}


% New theorem for theorems
\newtheorem{thm}{Theorem}[section]

%New theorem for definitions
\newtheorem{defn}{Definition}[section]

\maketitle



\section{Looking at other domains}

Given the relative success of using the \sch transform on the Ramsay horseshoe, and the disappointing results from the alternate Ramsay horseshoe, more conclusive evidence is needed to investigate the properties of the transform and its utility to smoothing over complex regions.





\section{General setup}

For all of the examples below the function \texttt{mvnorm} from the \textsf{R} package \texttt{MASS} was used to generate a  multivariate Normal surface over the region in question. This was then discretized over a 50 by 50 grid. A 500 replicate simulation experiment was then run at two noise levels ($\sigma^2=0.02$, $\sigma^2=0.005$) and two sample sizes (1000, 500.) For each replicate we fit a smooth of thin plate regression splines, the soap film smoother of \cite{soap} and finally thin plate regression splines on the \sch transformed domain. The transformation was performed by the \textit{SC Toolbox for MATLAB} and models were fit using \texttt{mgcv} in \textsf{R}. We then compared the results from each model by calculating the mean squared error over a 50 by 50 cell prediction grid.

\section{Example 1}

We begin with an example from \cite{miller09}. The shape (shown in \fig{fig9-disk-real}) does not include any kind of peninsula, such as that in the Ramsay horseshoe. This is a deliberate test of the performance of the \sch transform method and the soap film smoother in situations where they should not do as well as the thin plate regression splines. 

The polygon was transformed to both the unit disk and the rectangle to see if this made a difference to the fit. For the rectangular mapping, vertices chosen (somewhat arbitrarily) to map to those of the rectangle were 1, 6, 8 and 9 (see \fig{fig9-numbered}.) Other combinations were tested with no significant differences from those results presented here.

For the soap film smoother a 10 by 10 grid of which 41 inside knots were used. The cyclic spline which provides the boundary had 12 knots. Both thin plate regression splines were given 49 knots.

\begin{figure}[tbp]
\centering
% trim order l b r t
\includegraphics[width=2in]{figs-otherdomains/fig9-numbered.png} \\
\caption{Vertex numbering for the first example.}
\label{fig9-numbered}
% generated by Matlab
\end{figure}



\begin{figure}[p]
\centering
% trim order l b r t
\includegraphics[width=4in]{figs-otherdomains/fig9-boxplot.pdf} \\
\caption{Boxplot of the mean of the mean squared error per prediction point over 500 replicates for example 1 on the log scale. Non-log-scaled measurements below.}
\label{fig9-boxplots}
% generated by fig9test/makeboxplots.R
\end{figure}

\Fig{fig9-disk-real} shows an example fit for the three methods along with the true surface when the region is deformed to the unit disk. \Fig{fig9-rect-real} shows an analogous diagram for the rectangular domain transform. The results of the simulations are summarized in the boxplots in \fig{fig9-boxplots}.

\begin{figure}[tbp]
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/fig9-disk-real.pdf} \\
\caption{Truth and fits from one realization of the first example when it was transformed to the disk. Here the sample size was 500 and the noise level was set to 0.02.}
\label{fig9-disk-real}
% generated by fig9test/fit.irregular.R
\end{figure}

From this we can see that the thin plate regression splines appear to do very well for all cases, having the smallest MSE for each configuration. The MSEs become closer as the sample size drops.

Looking at \fig{fig9-disk-real} and \fig{fig9-rect-real} we can see that the \sch transform method seems to want to join the two high density areas on the surface. This is presumably due to the ``bunching-up'' of space due to the transform. Indeed, this effect can be seen in \fig{fig9-rect-bunching} and \fig{fig9-disk-bunching}. It looks as if this effect has exacerbated the problems that can be seen for the thin plate regression spline fit. This effect presumably accounts for the extra contour lines that can be seen in the \sch transformed fit.


\begin{figure}[tbp]
\centering
% trim order l b r t
\includegraphics[width=2.5in]{figs-otherdomains/fig9-pointplot-rect.pdf} \\
\caption{A plot of how a regular grid over the original domain is transformed using the \sch rectangular mapping. Numbers give vertices from \fig{fig9-numbered} under the mapping.}
\label{fig9-rect-bunching}
% generated by figs-otherdomains/fig9-pointmap.R 
\end{figure}


\begin{figure}[tbp]
\centering
% trim order l b r t
\includegraphics[width=2.5in]{figs-otherdomains/fig9-pointplot-disk.pdf} \\
\caption{A plot of how a regular grid over the original domain is transformed using the \sch unit disk mapping. Numbers give vertices from \fig{fig9-numbered} under the mapping.}
\label{fig9-disk-bunching}
% generated by figs-otherdomains/fig9-pointmap.R 
\end{figure}


\begin{figure}[tbp]
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/fig9-rect-real.pdf} \\
\caption{Truth and fits from one realization when there was a sample size of 500 and the noise level was set to 0.02 when the rectangular mapping was used. }
\label{fig9-rect-real}
% generated by fig9test/fit.irregular.R
\end{figure}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example 2}

The second example here is supposed to simulate the kind of domain that is common in surveys of marine animals, where there is some kind of peninsula in the domain. \Fig{wigglytop-numbered} shows the region in question. For this example a mapping to the rectangle was used with the vertices 1, 2, 3, and 18 used in order to try to squash the irregularities in the top of the domain. Other vertex combinations (as well as the CRDT method) were used but showed no particular advantage over the combination presented here\footnote{Indeed, some caused the numerical routines in the \emph{SC Toolbox for MATLAB} to crash.}. As with the first example it is not clear that the soap film or the4 \sch method will do well since there is no opportunuitty for leakage.

For the soap film, several knot configurations were tried, the best one was to have 30 boundary knots (for the cyclic spline) and a 9 by 9 grid of knots over the domain (of which 40 were inside the domain.) 

From the boxplots in \fig{wigglytop-boxplots} we can see that again, thin plate regression splines perform the best.

\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=2in]{figs-otherdomains/wigglytop-numbered.png} \\
\caption{Vertex numbering for the second example.}
\label{wigglytop-numbered}
% generated by Matlab
\end{figure}


% boxplot
\begin{figure}[p]
\centering
% trim order l b r t
\includegraphics[width=4in]{figs-otherdomains/wigglytop-boxplot.pdf} \\
\caption{Boxplot of the mean of the mean squared errors per prediction point over 500 replicates for the rectangle mapping for example 2. Non-log-scaled measurements below.}
\label{wigglytop-boxplots}
% generated by makeboxplots.R
\end{figure}


% realization
\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/wigglytop-real.pdf} \\
\caption{Truth and fits from one realization of the second example when there was a sample size of 500 and the noise level was set to 0.02. }
\label{wigglytop-real}
% generated by wigglytop fit.irregular.R
\end{figure}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example 3}

The third example is similar to the second but now has two peninsulae. Initially, a transform using \texttt{rectmap} was used, but this failed to converge, so \texttt{crrectmap} was used. The CRDT algorithm introduces extra vertices into the polygon with angle $\pi$, these are shown, along with the mapping in \fig{wigglytop2-numbered}. From this figure one can see that although there is no crowding in the numerical sense of \cite{driscoll} (ie. in a numerical sense), there is significant ``bunching-up'' of the vertices. Without even performing the mapping, it would seem that this would introduce odd artifacts into the smooth.

As with example 2, several combinations of vertex mappings and knots were tried. The result of this was that the vertices chosen to map to the corners of the rectangle were those shown in pink in \fig{wigglytop2-numbered}. For the soap film smoother a 15 by 15 grid of internal knots was used, of which 109 were inside the region. The cyclic spline around the boundary used 49 knots. Clearly this is the kind of domain in which the soap film smoother does very well. This is because of the effect of leakage across the boundary.

\Fig{wigglytop2-real} shows a realization for each of the methods. The \sch transform causes a huge distortion in the surface. The contour lines in the upper right pane of the figure show how the distortions have pushed the data points around, causing a very bad fit. It also looks as though the smooth has joined all of the points up across the domain, which is clearly not what we want here. The thin plate spline and the transform method both smooth over the details in the first peninsula. Here it appears that soap is doing significantly better than the other methods and we can see in the boxplots in \fig{wigglytop2-boxplots} the soap is vastly superior.

\Fig{wigglytop2-boxplots} also shows the results of using the bounding box shown in \fig{wigglytop2-bbox-numbered} with the \sch mapping (again mapping to the rectangle.) This was an attempt to reduce the distortions seen in \fig{wigglytop2-real}. As can be seen from the boxplots, there is no significant increase in performance by attempting to use the bounding box. Although this ironed out some of the weird features in the smooth, \fig{wigglytop2-bbox-real} shows that new features appear.



\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=3.5in]{figs-otherdomains/wigglytop2-numbered.png} \\
\caption{Mapping of the polygon to rectangle for the third example. Note the extra vertices added by the CRDT algorithm.}
\label{wigglytop2-numbered}
% generated by Matlab
\end{figure}

% boxplot
\begin{figure}[p]
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/wigglytop2-boxplot.pdf} \\
\caption{Boxplot of the mean mean squared error per prediction point over 500 replicates for the rectangle mapping for example 3 and the bounding box mapped to the rectangle.}
\label{wigglytop2-boxplots}
% generated by makeboxplots.R
\end{figure}


% realization
\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/wigglytop2-real.pdf} \\
\caption{Truth and fits from one realization when there was a sample size of 500 and the noise level was set to 0.02 when the rectangular mapping was used for example 3. }
\label{wigglytop2-real}
% generated by wigglytop2 fit.irregular.R
\end{figure}





\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=2in]{figs-otherdomains/wigglytop2-bbox-numbered.png} \\
\caption{The CRDT mapping of the bounding box to the rectangle for example 3.}
\label{wigglytop2-bbox-numbered}
% generated by Matlab
\end{figure}


% realization
\begin{figure}
\centering
% trim order l b r t
\includegraphics[width=3in]{figs-otherdomains/wigglytop2-bbox-real.pdf} \\
\caption{Truth and fits from one realization when there was a sample size of 500 and the noise level was set to 0.02 when the rectangular mapping was used on the bounding box case for example 3.}
\label{wigglytop2-bbox-real}
% generated by wigglytop2-bbox fit.irregular.R
\end{figure}


\section{Conclusion}

This is rubbish.

Arbitrary vertex choice.

SQuashing of the features in wigglytop case.












\bibliographystyle{plainnat}
\bibliography{sc-refs}



\end{document}
