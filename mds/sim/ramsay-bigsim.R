# do large scale simulations for wt2
# Copyright David Lawrence Miller 2009.


source("mds.R")
source("ramsay-smooth-test.R")

###############################
# initial setup
## create a boundary...
bnd <- fs.boundary()
bnd<-pe(bnd,seq(1,length(bnd$x),8))
bnd<-list(x=c(bnd$x,bnd$x[1]),y=c(bnd$y,bnd$y[1]))
# create points within the boundary 
m<-45;n<-25
xm <- seq(-1,3.5,length=m);yn<-seq(-1,1,length=n)
xx <- rep(xm,n);yy<-rep(yn,rep(m,n))
onoff<-inSide(bnd,xx,yy)
onoff[c(143,279)]<-FALSE ### UGLY HACK
xx<-xx[onoff];yy<-yy[onoff]

# map the grid xg,yg
gm<-20;gn<-10
xmg <- seq(-1,3.5,length=gm);yng<-seq(-1,1,length=gn)
xg <- rep(xmg,gn);yg<-rep(yng,rep(gm,gn))
onoffg<-inSide(bnd,xg,yg)
xg<-xg[onoffg];yg<-yg[onoffg]
my.grid<-list(x=xg,y=yg)
D.grid<-create_distance_matrix(xg,yg,bnd)
grid.mds<-cmdscale(D.grid,eig=TRUE,k=2)




#################################

sim.size<-200
samp.size<-250
noise.level<-1

res.mse<-list(mds=rep(0,sim.size), soap=rep(0,sim.size),tprs=rep(0,sim.size))

for(i in 1:sim.size){
   res<-ramsay_smooth_test(samp.size=samp.size,noise.level=noise.level,plot.it=FALSE,
                             bnd,my.grid,grid.mds,xx,yy, onoff)
   res.mse$mds[i]<- res$mds
   res.mse$soap[i]<-res$soap
   res.mse$tprs[i]<-res$tprs
}
write.csv(res.mse,file=paste("ramsay-",samp.size,"-",noise.level,".csv",sep=""))

